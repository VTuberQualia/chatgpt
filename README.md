# キックバイク乗りこなし判定AI

このリポジトリは、子どもがキックバイクに乗っている映像を解析し、ペダル付き自転車に乗れるようになる時期を推定するプロトタイプです。

## 要件定義

1. **入力データ**: 子どもとキックバイクが写っている動画。角度や大きさは問いません。
2. **出力**: ペダル付き自転車に乗れるかどうかの二択（OK/NG）。
3. **機能要件**
   - 動画からフレームを抽出し、子どもとキックバイクを検出する。
   - バランス、ハンドル操作、蹴り出しの強さなど動きの特徴量を算出する。
   - 準備が整っているかどうかラベル付けされたデータを使い、特徴量と準備度の相関を学習する。
   - 新しい動画を入力すると準備度を推定する推論用スクリプトを提供する。
4. **非機能要件**
   - Python 3 を使用し、映像処理には OpenCV、学習には PyTorch など一般的なパッケージを利用する。
   - 家庭のスマートフォンで撮影された角度や画角がまちまちな動画を想定する。
   - データセットを追加してもコード変更なしで学習と推論を切り替えられるようにする。

## プログラム構成

```
kickbike_analysis/
├── __init__.py
├── data_loader.py      # 動画読み込みとフレーム抽出
├── feature_extractor.py# フレームから動作特徴量を計算
├── model.py            # 機械学習モデル定義
├── train.py            # 学習エントリーポイント
└── infer.py            # 推論を行うスクリプト
```

- **data_loader.py**: 動画ファイルを読み込み、フレームやクリップに分割します。
- **feature_extractor.py**: 姿勢推定などを用いて数値特徴量を生成します。
- **model.py**: これらの特徴量を入力とする PyTorch 製のモデルを定義します。
- **train.py**: `data_loader` と `feature_extractor` を利用してラベル付きデータからモデルを学習します。
- **infer.py**: 学習済みモデルを読み込み、未知の動画に対してOK/NGを判定します。

モジュールを分離することで各要素を個別にテスト・拡張しやすい構成としています。

学習用ディレクトリには `labels.csv` を配置し、各動画ファイル名と`ok` または `ng` のラベルをカンマ区切りで記載してください。

## 使い方

推論だけを試す場合は `analyze_video.py` を実行します。Windows のフルパスも指定できます。

```bash
python -m kickbike_analysis.analyze_video "D:\\20250525_ビタミンiファクトリーイベント動画\\DJI_20010311100342_0003_D.MP4"
```

スクリプトは光学フローを用いた簡易的な特徴量をもとに、揺れの大きさと速度変化の滑らかさから「可」または「不可」を判定します。



## 学習の実行

学習用の動画と `labels.csv` をまとめたディレクトリを用意し、依存パッケージをインストールした上で `train.py` を実行します。

```bash
# 依存ライブラリのインストール (リポジトリ直下に `requirements.txt` を同梱しています)
pip install -r requirements.txt

# データセットはリポジトリ直下の `data/` ディレクトリに配置
python -m kickbike_analysis.train
```

学習が完了すると `model.pt` が保存され、`infer.py` から利用できます。
=======
